---
title: "week10"
author: "Isabel and Eric"
date: "3/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#start putting together prettier script 

svi <- read.csv("Datasets/SVI2018_US_COUNTY.csv")
#drop none numeric columns (county/state names)
svi_temp <- svi[-c(6:9)]

#drop margins of error 

#colnames(svi_temp)

svi_temp <- svi_temp[, grep('^EP', colnames(svi_temp)) ]
svi_temp$FIPS <- svi$FIPS
colnames(svi_temp)
```

```{r}
#get ideal number of clusters 
fviz_nbclust(svi_temp, FUN = hcut, method = "wss")
fviz_nbclust(svi_temp, FUN = hcut, method = "silhouette")

```


```{r}
#ward hierarchical clustering 
#just thrwoing shit at the wall and seeing what sticks

d <- dist(svi_temp, method = "euclidean") #translate data to distance
fit <- hclust(d, method = "ward.D2")
plot(fit, cex = 0.6, hang = -1)
groups <- cutree(fit, k = 3)

table(groups)
#plot.new()
#rect.hclust(fit, k=5, border="red")
```




```{r}
fviz_cluster(list(data = svi_temp, cluster = groups))
```


```{r}
fviz_nbclust(svi_temp, FUN = hcut, method = "wss")

#ward hierarchical clustering 
#just thrwoing shit at the wall and seeing what sticks

d <- dist(svi_temp, method = "euclidean") #translate data to distance
fit <- hclust(d, method = "complete")
plot(fit)
groups <- cutree(fit, k = 3)

table(groups)
#plot.new()
#rect.hclust(fit, k=5, border="red")


```

```{r}
library(cluster)
hc_a <- agnes(svi_temp, method = "ward")
groups <- cutree(as.hclust(hc_a), k = 3)

table(groups)
hc_a$ac

fviz_cluster(list(data = svi_temp, cluster = groups))

```



```{r}
# Cut diana() tree into 4 groups
hc_d <- diana(svi_temp)
groups <- cutree(as.hclust(hc_d), k = 3)

table(groups)
hc_d$dc
```


```{r}
#add clusters to dataframe 
svi_temp$cluster = groups

pop <- read_csv("Datasets/covid_county_population_usafacts.csv")

#just reading in covid data from enviornment 
#run data_manipulation.Rmd to update covid data with api 

cv2 <- read_csv("Datasets/covid_data.csv")
cv2 <- cv2[c(1, 2, 4)]
#fix later
names(cv2)[1] <- "FIPS"
#add covid data to SVI
svi_temp <- merge(cv2, svi_temp, by='FIPS') 
#add population
pop <- pop[-c(2,3)]
names(pop)[1] <- "FIPS"

svi_temp <- merge(pop, svi_temp, by='FIPS') 
```


```{r}
#adjust covid totals to ratios of population
svi_temp$case_by_pop <- svi_temp$total_cases / svi_temp$population *10000
svi_temp$death_by_pop <- svi_temp$total_death / svi_temp$population *10000
```

