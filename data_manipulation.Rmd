---
title: "Data_Manipulation"
author: "Isabel and Eric"
date: "12/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown
```{r}
library(tidyverse)
library(plyr)
library(dplyr)

```


```{r}
#this is cities not counties fuck my life 
base_dat <- read_csv('19estimates_counties.csv')

clist <- split(base_dat, base_dat$GEOID)

```

```{r}
foo <- as.data.frame(t(clist[[1]]))

#remove columns without data 
countyA_dat <- foo[-c(1, 2, 3, 17, 20, 23, 24, 32, 33, 40, 47, 48, 56, 57, 65, 69, 70, 77, 78, 87, 90, 91, 94, 95, 98, 101, 104, 107, 108, 117, 118, 126, 127, 131, 132, 134, 138, 142, 143, 151, 152, 165, 166, 195, 196)]
#there is a better way to do this - maybe if question number isnt a whole number

#remove rows with all NAs 
not_all_na <- function(x) any(!is.na(x))

countyA_dat <- na_if(countyA_dat, "(X)")
countyA_dat %>% select_if(not_all_na) #I cant tell if this is working or not

```

```{r}
clean_county <- function(county_df){
  t_county <- as.data.frame(t(county_df))
  county_dat <- t_county[-c(1, 2, 3, 17, 20, 23, 24, 32, 33, 40, 47, 48, 56, 57, 65, 69, 70, 77, 78, 87, 90, 91, 94, 95, 98, 101, 104, 107, 108, 117, 118, 126, 127, 131, 132, 134, 138, 142, 143, 151, 152, 165, 166, 195, 196)]
  not_all_na <- function(x) any(!is.na(x))

  county_dat <- na_if(county_dat, "(X)")
  county_dat <- county_dat %>% select_if(not_all_na)
  #rename cols 
  names(county_dat) <- county_dat[6,]


  return(county_dat)
}
  
```

```{r}

new_tib_list <- lapply(clist, clean_county)
```

```{r}
add_loc_cols <- function(county_dat){
  county_dat$GEOID <- as.list(county_dat[2,][1:15])
  county_dat$GEONAME <- as.list(county_dat[3,][1:15])
  return(county_dat)
}

tiblist <- lapply(new_tib_list, add_loc_cols)

tiblist[[2]]

#TO DO:
#-try pivot wider? 
#- make geo locations cols? 
#- combine dfs into one 
```

```{r}
svi <- read.csv("SVI2018_US_COUNTY.csv")
svi

```




